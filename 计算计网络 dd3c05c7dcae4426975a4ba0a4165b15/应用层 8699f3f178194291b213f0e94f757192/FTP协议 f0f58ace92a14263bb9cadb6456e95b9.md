# FTP协议

# FTP协议

【定义】

是一种用于在网络上传输文件的标准协议。

它定义了客户端和服务器之间的通信规则，支持客户上传和下载文件到/从服务器。

【数据连接模式模式】

分为主动模式和被动模式。主动模式是服务器主动，被动模式是服务器被动

具体如下：

主动模式下，客户端发起数据传输请求时，客户端会随机选择一个端口并通过命令通道（默认端口21）通知服务器使用这个端口建立数据连接。服务器接受到命令，主动向客户端指定的端口请求建立通信，该模式可能会遇到客户端的防火墙阻拦。

被动模式下，服务器在收到客户端的数据传输请求后，会随机选择一个端口并通过命令通道通知客户端要使用这个端口进行数据连接，然后被动等待客户端收到命令后向该端口请求建立通信。

一般来说被动模式比较常用，因为这样可以不需要考虑客户端的防火墙规则，且可以让客户端不多暴露一个端口提高危险性。

【传输模式】

支持ASCII模式和二进制模式。

其中：

ASCII模式用于文本文件，会将内容以对应ascii字符呈现，同时将换行符转换为适应目标操作系统的标准。

而二进制模式用于非文本文件，不会对其中的数据进行任何更改。

> 不用担心utf-8下选什么模式，因为FTP的具体实现的程序如xshell一般会自动识别文本内容的编码方式并做对应的处理。
> 

【协议实现过程】

**1、建立连接**

在连接建立后，用户需要提供用户名和密码进行身份验证。

其中，FTP支持匿名登录，即用户可以使用“anonymous”作为用户名，然后提供电子邮件地址作为密码。（但是这种登录方式经常被防火墙禁用掉qwq）

**2、传输命令+数据**

FTP使用两个TCP连接来传输数据，一个用于传输命令（命令连接，通常使用端口21），另一个用于传输实际文件数据（数据连接，使用不同的端口）。

其所支持的命令包括：

上传（put）、下载（get）、删除（delete）、重命名（rename）、列出目录内容（ls）和切换工作目录（cd）等。

# SFTP协议

【定义】

原始的FTP是不安全的，因为它传输的数据是明文的，包括用户名和密码。

为提高安全性，现主流的方案是使用更安全的FTP变体，如SFTP（SSH File Transfer Protocol）。

因为其基于SSH，所以其默认使用SSH的端口，即22。

【加密】

全程两个TCP连接看到数据都基于SSH进行加密，可要求服务端进行证书验证、设定公私钥。

【内容增强】

**扩展功能：**SFTP支持文件和目录的属性，这包括文件权限、所有者、创建时间等信息，用于进行目录检索等操作。同时，SFTP还支持了更多对文件目录的操作，这就实现了一个结果——提供了透明的远程文件系统访问，用户可以像访问本地文件一样访问远程服务器上的文件。

**更详细的报错**：能够提供详细的错误信息，这有助于用户更好地理解发生的问题。