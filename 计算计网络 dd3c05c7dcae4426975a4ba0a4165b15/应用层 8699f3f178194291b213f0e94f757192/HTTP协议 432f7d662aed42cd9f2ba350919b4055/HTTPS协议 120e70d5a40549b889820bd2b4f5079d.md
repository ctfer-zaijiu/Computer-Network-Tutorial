# HTTPS协议

【定义】

在http协议的基础上，通过使用SSL或TLS协议来加密通信内容。

> TLS协议可以视为SSL协议的升级版，HTTPS协议可以选择基于SSL还是TLS，但是基本上SSL已经被淘汰，主流都是基于更安全的TLS。
> 

其默认端口为443。

【https总体过程】

当用户访问一个使用HTTPS的网站时，客户端和服务器之间的通信首先建立一个基于HTTP的非加密的连接，然后通过TLS握手过程启动安全连接。

【TLS握手过程】

TLS握手过程实际是验证数字证书，并通过非对称加密算法实现协定一个对称加密秘钥作为会话秘钥，具体如下：

1. **客户端Hello：** 握手开始时，客户端向服务器发送一个ClientHello消息。这个消息包含支持的TLS版本、加密算法、压缩算法等信息。同时，客户端会生成一个随机数（ClientRandom）。
2. **服务器Hello：** 服务器收到ClientHello后，从中选择一个支持的TLS版本，并向客户端发送一个ServerHello消息。服务器也生成一个随机数（ServerRandom）。在这个阶段，服务器还会发送数字证书，用于证明服务器的身份。
3. **认证：** 客户端收到服务器的数字证书后，会验证证书的有效性，包括检查证书是否由可信的证书颁发机构签发。客户端还可以确认证书中的公钥是否与服务器实际公开的公钥匹配。
    
    这一步中，可以在浏览器中手动选择相信服务器的数字证书，在我们用bp进行https流量代理的时候就需要这么做。
    
4. **预主密钥生成：** 客户端生成一个预主密钥（Pre-Master Secret），并使用服务器的公钥对其进行加密，然后将加密后的预主密钥发送给服务器。
5. **密钥交换：** 服务器收到客户端发送的加密的预主密钥后，使用自己的私钥进行解密，得到预主密钥。现在，客户端和服务器都拥有了相同的预主密钥。
6. **生成会话密钥：** 客户端和服务器使用之前生成的随机数（ClientRandom、ServerRandom）以及预主密钥来计算出主密钥（Master Secret）。这个主密钥用于生成会话密钥和其他加密参数。
7. **完成握手：** 客户端和服务器分别通知对方握手过程已经完成。此时，它们可以开始使用生成的会话密钥进行安全通信。
    
    其中，会话秘钥双方均持有，是一个对称加密秘钥，之所以使用对称加密是因为效率更高。