# 路由选择与分组转发规则

# 一、相关基础概念

**跳数：**

从一个路由转发到另一个路由为1“跳”

**TTL&子网不可达：**

网络最大跳数限制，为15，超过这个跳数的路径将被认为是无穷远（或“子网不可达”）。

该机制的设置是为了防止在网络中形成环路。

**距离：**

距离是以“跳数”来衡量的

# 二、路由算法

【定义】

是网络中用于确定数据包从源子网到目标子网的路径的一组算法。

其中，每个路由器应维护一张路由表，表中记录了各个网络的网络号和与之相连的路由器端口的对应关系。理论上，每个路由器的路由表上应包含整个公网的所有网络号，以便有效地将数据包转发到目标网络。

【分类】

1. **静态（&非自适应）路由算法：**
   
    人为配置维护路由表，表的内容静态不变，适用于一些封闭的小型网络，例如小型企业内网&军事网络。
    
2. **动态（&自适应）路由算法：**
   
    路由自动配置路由表，表的内容随着网络拓扑的变化而自动调整，调整具体是以定期自动更新的方式实现。
    
    动态路由算法应用广泛，公网中使用的就是这种方案，其具体又分为以下两种算法：
    
    （1）**距离-向量路由算法（RIP）：**
    
    基本概念：
    
    向量：各个路由器维护一个向量表，表中描述了当前路由器到其他各个网络的最短距离以及向那个目的地应跳往的下一个路由器，如下表：
    
    | 目标网络地址 | 下一跳路由器 | 距离（跳数） |
    | --- | --- | --- |
    | 192.168.1.0 | Router A | 2 |
    | 10.0.0.0 | Router B | 1 |
    
    实现：
    
    相邻路由器之间周期性地交换各自的向量表。
    
    路由器再得到多张邻居的向量表后，比对自己应该通过哪个邻居可以实现到达某目的地的距离最短化，并将该最短路径距离和下一跳路由记录在表中。
    
    > 基于Bellman-Ford算法的
    > 
    
    （2）**链路状态路由算法（OSPF）：**
    
    基本概念：
    
    链路状态：是指一个路由器对相邻路由器和连接的链路的状态信息，如带宽、延迟等。
    
    链路状态数据库： 每个路由器维护一个链路状态数据库，其中包含了整个网络的拓扑信息和链路状态，也就类似于是一个带权图。
    
    区域：OSPF网络可以被划分为一个或多个区域，每个区域有一个唯一的标识号。这有助于提高网络的可伸缩性。
    
    实现：
    
    各个路由器定期向相邻路由发出一个链路状态广播，广播内容为当前路由器所连的所有边的链路状态。路由器根据自己收到的广播内容来更新路由表。
    
    使用Dijkstra算法计算最短路径树，该树表示到达网络中所有其他路由器的最短路径。
    
    <aside>
    💡 记两个协议的名字和类型！
    
    </aside>
    

# 三、路由聚合

【定义】

假设有以下两个路由表项：

1. 192.168.1.0/24
2. 192.168.2.0/24

通过路由聚合，这两个表项可以被合并为一个更广泛的CIDR表示：192.168.1.0/23。

这样一来，这两个子网就可以被视为一个子网，也就被视为一个路由器，这样就可以实现减小路由表的规模。