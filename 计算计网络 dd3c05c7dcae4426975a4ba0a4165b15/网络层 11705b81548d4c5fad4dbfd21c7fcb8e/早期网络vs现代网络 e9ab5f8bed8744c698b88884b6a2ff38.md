# 早期网络vs现代网络

# 一、早期网络和现代网络的对比

> 这里以`私有网络+NAT`以节省公网IP的策略的应用为分界线
> 

早期互联网结构如图：

![Untitled](%E6%97%A9%E6%9C%9F%E7%BD%91%E7%BB%9Cvs%E7%8E%B0%E4%BB%A3%E7%BD%91%E7%BB%9C%20e9ab5f8bed8744c698b88884b6a2ff38/Untitled.png)

早期公网由许多公网子网构成，公网上的任何一个公网子网中的主机可以和另一个公网子网中的主机通信，公网子网上的任何一台主机使用公网IP，且基于ABC类IP地址来获得网段号。

那时候也有私有网络，但主要是用于搭建内网。

后来由于IPv4地址的枯竭，私有网络技术被广泛用于解决公网IP的稀缺性问题，导致现代的互联网结构如图：

![Untitled](%E6%97%A9%E6%9C%9F%E7%BD%91%E7%BB%9Cvs%E7%8E%B0%E4%BB%A3%E7%BD%91%E7%BB%9C%20e9ab5f8bed8744c698b88884b6a2ff38/Untitled%201.png)

家用路由器、交换机管理一片私有网络。

同时，家用路由器使用了 NAT（网络地址转换） 技术，将设备的私有IP地址映射为家用路由上的一个公共IP地址，从而使得这些设备能够正常访问公网。

# 二、早期网络相关技术

### 1-ABC地址分类

早期互联网中为了划分出不同规模的公网子网，我们将公网IP地址分为以下三类。

当拿到一个公网IP时，我们可以根据其第一个字节处于哪个范围内来判断其属于哪一类IP地址。

- **A类地址：**
    
    范围：1.0.0.0 到 126.255.255.255，第一个字节是1~126
    
    网络位：`xxx.xxx.xxx.xxx`
    
- **B类地址：**
    
    范围：128.0.0.0 到 191.255.255.255，第一个字节是128~191
    
    网络位：`xxx.xxx.xxx.xxx`
    
- **C类地址：**
    
    范围：192.0.0.0 到 223.255.255.255，第一个字节是192~223
    
    网络位：`xxx.xxx.xxx.xxx`
    

<aside>
💡 背三类ip地址的范围！这里可以取巧只记住128和191两个界限数字。

</aside>

### 2-用于构建内网的私有网络

【定义】

用私有网络技术构建一片内网，其中的设备使用的是IP地址中被保留的特殊的“私有IP”，其中的设备不能与公网中的其他设备互通。

但是可以通过在当前私有网络中和私有网络外的某一台主机中设置同一个VPN，从而建立起VPN通道，因为VPN具有访问控制的机制，所以可以实现在安全的访问控制下的通内网。

【私有IP地址】

我们在IP地址中保留以下这三种特殊IP地址作为私有IP地址，专门用于私有网络内主机之间进行交流：

- **私有A类地址：** 10.0.0.0 到 10.255.255.255
- **私有B类地址：** 172.16.0.0 到 172.31.255.255
- **私有C类地址：** 192.168.0.0 到 192.168.255.255

# 三、现代网络相关技术

### 1-子网掩码

后来，为了使私有网络可以灵活配置主机号容量，所以设置了CIDR（无类域间路由）规则：

在公网IP中：

**废除了ABC类IP地址，只通过在包中附带一条子网掩码表示网络号/主机号的分界。**

在私有IP中：

**为了兼容性仍采用公网IP中保留的ABC类私有IP表示私有网络，但废除了私有ABC类型表示网络号/主机号分界的意义，只采用子网掩码来表示主机号和网络号的分界**。

子网掩码有两种表现方式：

- 将IP地址表示为`IP地址/子网掩码`的形式，例如`192.168.1.0/24`。这里的"/24"表示前24位是网络位，剩下的8位是主机位。
- 以`255.255.255.0`的形式表示子网掩码，表示前24位是网络位，剩下的8位是主机位。

### 2-用途被拓展的私有网络

**【定义】**

现代网络中，私有网络技术被拓展为以下两种应用：

- 用于构建一片子网，使之不向公网暴露，称为“内网”
- 用于与NAT技术结合实现“让更多设备联网而不占用公网IP地址”，从而节省公网IP地址。

**【私有网络+NAT实现节省公网IP地址】**

现代，由于IPv4地址的不够用，私有网络技术被广泛用于节省公网IP地址。

家用路由是一种集成了路由和交换机的设备。

每个家用路由器管理一片私有网络，这片私有网络内的设备想要访问公网时，通过 NAT（网络地址转换） 技术将自己的IP换成家用路由的公共IP，然后访问公网。

校园网也是类似原理，它是一个巨大的私有网络，网络内每个节点拥有一个私有IP，当节点想要被访问公网时，校园网会从一个公有IP池中取出一个公有IP用于与该私有IP进行NAT转换。

这使得一家内的多台设备只需占一个公网IP，一校内的多台设备只需占少量几个公网IP。

**【NAT技术实现】**

基于端口映射，家用路由器中会维护一张NAT表，描述了私有套接字和公网套接字之间的映射规则如下：

```php
172.48.10.15:40001 → 192.168.0.2:30000
172.48.10.15:40002 → 192.168.0.3:30000
172.48.10.15:40003 → 192.168.0.3:30000
```

可以看到家用路由器只占用一个公网IP“172.48.10.15”，并将其根据不同端口映射给不同的私有IP

**【私有IP地址】**

ABC三类私有IP被保留，但是私有IP地址的网络号改为用子网掩码决定，这样可以提升灵活性。

例如我想用私有C类地址，但是我不需要255*255这么大的主机号量，就可以使用255.255.255.0作为子网掩码，这样就只使用255个主机号量。

**【查看公网IP&私有IP】**

- 以下方式可以查到私有IP地址和子网掩码：
    
    ![Untitled](%E6%97%A9%E6%9C%9F%E7%BD%91%E7%BB%9Cvs%E7%8E%B0%E4%BB%A3%E7%BD%91%E7%BB%9C%20e9ab5f8bed8744c698b88884b6a2ff38/Untitled%202.png)
    
- 以下方式可以查到NAT映射得到的那个公网IP地址：
    
    ![Untitled](%E6%97%A9%E6%9C%9F%E7%BD%91%E7%BB%9Cvs%E7%8E%B0%E4%BB%A3%E7%BD%91%E7%BB%9C%20e9ab5f8bed8744c698b88884b6a2ff38/Untitled%203.png)